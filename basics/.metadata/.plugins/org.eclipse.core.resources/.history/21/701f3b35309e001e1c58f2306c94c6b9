/*
 * external_interrupt_config.c
 *
 *  Created on: 19-Dec-2023
 *      Author: naveen
 */

#include "stm32f4xx.h"
#include "gpio_driver.h"
#include "external_interrupt_config.h"

void configure_external_interrupt(void)
{

	uint32_t *pAPB2ENR = (uint32_t *) APB2_ENR_ADDR;
	uint32_t *pEXTI_IMR	= (uint32_t *) EXTI_IMR_ADDR;
	uint32_t *pEXTI_RTSR = (uint32_t *) EXTI_RTSR_ADDR;
	uint32_t *pSYSCFG_EXTI_CR_ADDR = (uint32_t *) SYSCFG_EXTI_CR_ADDR;

	//GPIO Pin Configuration
	EnablePeriClk(GPIOA);
	GPIOSetMode(GPIOA,BUTTON_PIN,GPIO_MODE_INPUT);

	//Button Interrupt Configuration

	// 1. Configuring the EXTI Controller (External Interrupt Controller)

	*pEXTI_IMR |= (1 << EXTI_INTERRUPT_PIN_NUM);  	// Setting the Interrupt Mask Register
	*pEXTI_RTSR |= (1 << EXTI_INTERRUPT_PIN_NUM); 	// Setting the Rising Trigger Set Register

	*pAPB2ENR |= (1 << 14);							// Enabling the clock for the System Configuration Block
	*pSYSCFG_EXTI_CR_ADDR &= ~(0x000F);       		// Enabling GPIOA Port O input on EXTI0 line

	// 2. // Enabling the interrupt for the button
	NVIC_EnableIRQ(BUTTON_IRQ_NO);					// Enabling the interrupt
}
