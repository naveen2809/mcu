/*
 * 	ds3231_rtc_driver.c
 *	Driver Code for the DS3231 RTC Module from Maxim
 *	Reference: https://www.analog.com/media/en/technical-documentation/data-sheets/ds3231.pdf
 *  Created on: 08-Jan-2024
 *      Author: naveen
 */

#include "ds3231_rtc_driver.h"
#include "rtc_driver.h"
#include "common_utils.h"
#include "external_interrupt_config.h"

void RTC_DS3231_Config_Calendar(struct RTC_DS3231_Config_t *pRTCConfig)
{
	uint8_t Tx_Buf[5];
	struct Time ds3231_time;
	struct Date ds3231_date;

	//Configuring the Time Parameters
	memset(&ds3231_time,0,sizeof(struct Time));
	ds3231_time.seconds = (pRTCConfig->RTCClockSecondsUnits << DS3231_RTC_TR_SU) | (pRTCConfig->RTCClockSecondsTens << DS3231_RTC_TR_ST);
	ds3231_time.minutes = (pRTCConfig->RTCClockMinutesUnits << DS3231_RTC_TR_MNU) | (pRTCConfig->RTCClockMinutesTens << DS3231_RTC_TR_MNT);
	ds3231_time.hours = (pRTCConfig->RTCClockHoursUnits << DS3231_RTC_TR_HU) |  (pRTCConfig->RTCClockHoursTens << DS3231_RTC_TR_HT) | (pRTCConfig->RTCClockAMPM << DS3231_RTC_TR_PM);
	Tx_Buf[0] = 0x00;
	Tx_Buf[1] = ds3231_time.seconds;
	Tx_Buf[2] = ds3231_time.minutes;
	Tx_Buf[3] = ds3231_time.hours;
	I2CMasterSendData(I2C_DEVICE,Tx_Buf,4,SlaveAddress);
	delay_us(2000);

	//Configuring the Data Parameters
	memset(&ds3231_date,0,sizeof(struct Date));
	ds3231_date.dayofweek = (pRTCConfig->RTCClockDayOfWeek << DS3231_RTC_DR_WDU);
	ds3231_date.date = (pRTCConfig->RTCClockDateUnits << DS3231_RTC_DR_DU) | (pRTCConfig->RTCClockDateTens << DS3231_RTC_DR_DT);
	ds3231_date.month = (pRTCConfig->RTCClockMonthUnits << DS3231_RTC_DR_MU) | (pRTCConfig->RTCClockMonthTens << DS3231_RTC_DR_MT);
	ds3231_date.year = (pRTCConfig->RTCClockYearUnits << DS3231_RTC_DR_YU) | (pRTCConfig->RTCClockYearTens << DS3231_RTC_DR_YT);
	Tx_Buf[0] = 0x03;
	Tx_Buf[1] = ds3231_date.dayofweek;
	Tx_Buf[2] = ds3231_date.date;
	Tx_Buf[3] = ds3231_date.month;
	Tx_Buf[4] = ds3231_date.year;
	I2CMasterSendData(I2C_DEVICE,Tx_Buf,5,SlaveAddress);

	return;
}

void RTC_DS3231_Read_Calendar(struct Date *date, struct Time *time)
{



}

void RTC_DS3231_Config_Alarm(struct RTC_DS3231_AlarmConfig_t *pRTCAlarmConfig)
{
	uint8_t seconds, minutes, hours, date;

	seconds = (pRTCAlarmConfig->RTCAlarmSecondsUnits << DS3231_RTC_ALRMR_SU) | (pRTCAlarmConfig->RTCAlarmSecondsTens << DS3231_RTC_ALRMR_ST) | (pRTCAlarmConfig->RTCAlarmConsiderSeconds << DS3231_RTC_ALRMR_MSK1);
	minutes = (pRTCAlarmConfig->RTCAlarmMinutesUnits << DS3231_RTC_ALRMR_MNU) | (pRTCAlarmConfig->RTCAlarmMinutesTens << DS3231_RTC_ALRMR_MNT) | (pRTCAlarmConfig->RTCAlarmConsiderMinutes << DS3231_RTC_ALRMR_MSK2);
	hours = (pRTCAlarmConfig->RTCAlarmHoursUnits << DS3231_RTC_ALRMR_HU) |  (pRTCAlarmConfig->RTCAlarmHoursTens << DS3231_RTC_ALRMR_HT) | (pRTCAlarmConfig->RTCAlarmAMPM << DS3231_RTC_ALRMR_PM) | (pRTCAlarmConfig->RTCAlarmConsiderHours << DS3231_RTC_ALRMR_MSK3);
}
